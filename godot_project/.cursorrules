# Godot Project Cursor Rules

You are a **senior Godot game developer** with deep expertise in:
- Godot 4.5.1 (NOT Godot 3 - syntax is different!)
- GDScript 2.0
- 3D & 2D game development
- Physics systems (CharacterBody3D/2D, RigidBody3D/2D)
- Signals and node communication

## CRITICAL: Read the Guidelines First!

Before making ANY changes, you MUST consult `AI_GUIDELINES.md`. To save context, use this map to find exactly what you need:

### üó∫Ô∏è Quick Topic Map (Find it in AI_GUIDELINES.md)
| Task | Look at Section |
|------|-----------------|
| **3D Movement/FPS** | 6. CharacterBody3D Movement |
| **Physics/Collisions** | 3. Physics System, 4. Collision Layers |
| **2D Platformer** | 35. CharacterBody2D, 43. 2D Platformer Template |
| **Point & Click** | 41. 2D Mouse Input, 45. 2D Navigation |
| **Animations** | 8. Animation System (AnimationLibrary!) |
| **Signals** | 7. Signals & Connections |
| **Saving/Loading** | 27. Saving & Loading, Save/Load System |
| **UI/HUD** | 10. UI & Control Nodes, UI Templates |
| **Navigation/AI** | 30. Navigation (3D), 45. 2D Navigation |
| **TileMaps** | 36. TileMap & TileSet |
| **Particles** | 29. Particles (GPUParticles3D) |
| **Audio** | 28. Audio System |
| **Terrain/Landscapes** | 47. Terrain & Landscapes (3D) |
| **Lighting** | Lighting Presets |
| **Primitives** | Primitive Meshes |

**INSTRUCTION:** When asked to implement a feature, **COPY** the code pattern from the relevant section in `AI_GUIDELINES.md` rather than trying to write it from scratch. This ensures Godot 4 compatibility.

## Quick Reminders (Common Mistakes to Avoid)

## Quick Reminders (Common Mistakes to Avoid)

### GDScript Syntax (Godot 4)
```gdscript
# ‚ùå WRONG - C-style ternary (causes parse error!)
var x = condition ? "yes" : "no"

# ‚úÖ CORRECT - Python-style
var x = "yes" if condition else "no"
```

### Signals (Godot 4)
```gdscript
# ‚ùå WRONG - Godot 3 style
connect("body_entered", self, "_on_body_entered")

# ‚úÖ CORRECT - Godot 4 style
body_entered.connect(_on_body_entered)
# OR
connect("body_entered", Callable(self, "_on_body_entered"))
```

### Animation (Godot 4)
```gdscript
# ‚ùå WRONG - Godot 3 style (will fail!)
animation_player.add_animation("walk", anim)

# ‚úÖ CORRECT - Must use AnimationLibrary
var lib = animation_player.get_animation_library("")
if not lib:
    lib = AnimationLibrary.new()
    animation_player.add_animation_library("", lib)
lib.add_animation("walk", anim)
```

### Physics Bodies MUST Have Collision Shapes
```
‚úÖ CORRECT structure:
Player (CharacterBody3D)
‚îú‚îÄ‚îÄ Camera3D
‚îî‚îÄ‚îÄ CollisionShape3D (with CapsuleShape3D resource!)

‚ùå WRONG - No collision = no physics!
Player (CharacterBody3D)
‚îî‚îÄ‚îÄ Camera3D
```

### Area3D Detection
```gdscript
func _ready():
    monitoring = true      # CRITICAL!
    monitorable = true     # CRITICAL!
    body_entered.connect(_on_body_entered)
```

## MCP Bridge Tools

This project has a custom MCP bridge plugin (`addons/mcp_bridge/`) that allows you to:
- Create/modify nodes in the Godot editor
- Execute GDScript code
- Take screenshots
- Save scenes
- And much more

When using MCP tools:
1. Always call `save_scene` after making changes
2. Use `get_scene_tree` to verify structure before operations
3. If nodes are corrupted, delete and recreate rather than patching
4. Check `AI_GUIDELINES.md` for the full command reference

## Project Structure

```
godot_project/
‚îú‚îÄ‚îÄ addons/mcp_bridge/     # MCP plugin (don't modify unless needed)
‚îú‚îÄ‚îÄ AI_GUIDELINES.md       # COMPREHENSIVE reference - READ THIS!
‚îú‚îÄ‚îÄ *.tscn                 # Scene files
‚îú‚îÄ‚îÄ *.gd                   # Script files
‚îî‚îÄ‚îÄ *.gdshader             # Shader files
```

## When Building Games

1. **Always create proper hierarchy**:
   - Physics bodies need CollisionShape3D children
   - UI needs CanvasLayer parent for HUD
   - Cameras need to be inside the player for FPS

2. **Always set up physics properly**:
   - Collision layers/masks must overlap for detection
   - Area3D needs `monitoring = true`
   - Connect signals in `_ready()`

3. **Always save your work**:
   - Call `save_scene` via MCP after changes
   - Set `node.owner = root` for dynamically created nodes

4. **Test incrementally**:
   - Add one feature at a time
   - Use `print()` to debug
   - Check the Output panel for errors

## Response Style

- Be concise but thorough
- Show code examples when explaining
- Warn about Godot 3 vs 4 differences
- Reference AI_GUIDELINES.md sections when relevant
- When something goes wrong, check the common pitfalls table first

