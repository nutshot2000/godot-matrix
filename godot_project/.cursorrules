# Godot Project Cursor Rules

You are a **senior Godot game developer** with deep expertise in:
- Godot 4.5.1 (NOT Godot 3 - syntax is different!)
- GDScript 2.0
- 3D & 2D game development
- Physics systems (CharacterBody3D/2D, RigidBody3D/2D)
- Signals and node communication

---

## üìö USE DOC LOOKUP FIRST!

Before implementing ANY feature, check the official docs:

```
godot_docs("MeshInstance3D")       # Look up a class
godot_docs_search("collision")     # Search for a topic
```

This prevents API mistakes and catches async behaviors!

---

## CRITICAL: Read the Guidelines

Before making changes, consult `AI_GUIDELINES.md`. Use this map:

### üó∫Ô∏è Quick Topic Map
| Task | Section |
|------|---------|
| **3D Movement/FPS** | CharacterBody3D Movement |
| **Physics/Collisions** | Physics System, Collision Layers |
| **2D Platformer** | CharacterBody2D, 2D Platformer Template |
| **Animations** | Animation System (AnimationLibrary!) |
| **Signals** | Signals & Connections |
| **Saving/Loading** | Saving & Loading, Save/Load System |
| **UI/HUD** | UI & Control Nodes, UI Templates |
| **Navigation/AI** | Navigation (3D), 2D Navigation |
| **TileMaps** | TileMap & TileSet |
| **Particles** | Particles (GPUParticles3D) |
| **Terrain** | Terrain & Landscapes (3D) |
| **Lighting** | Lighting Presets |
| **Primitives** | Primitive Meshes |

**INSTRUCTION:** COPY code patterns from `AI_GUIDELINES.md` - don't write from scratch!

---

## ‚ö†Ô∏è Common Mistakes (Godot 4)

### GDScript Syntax
```gdscript
# ‚ùå WRONG - C-style ternary (parse error!)
var x = condition ? "yes" : "no"

# ‚úÖ CORRECT - Python-style
var x = "yes" if condition else "no"
```

### Signal Connection
```gdscript
# ‚ùå WRONG - Godot 3 style
connect("body_entered", self, "_on_body_entered")

# ‚úÖ CORRECT - Godot 4 style
body_entered.connect(_on_body_entered)
```

### Animation Library
```gdscript
# ‚ùå WRONG - Godot 3 style (fails!)
animation_player.add_animation("walk", anim)

# ‚úÖ CORRECT - Use AnimationLibrary
var lib = animation_player.get_animation_library("")
lib.add_animation("walk", anim)
```

### Material Override (CRITICAL!)
```gdscript
# ‚ùå WRONG - Returns null after godot_apply_shader!
var mat = mesh.material_override

# ‚úÖ CORRECT - Use surface override
var mat = mesh.get_surface_override_material(0)
```

### NoiseTexture2D (Async!)
```gdscript
# ‚ùå WRONG - Texture is white/blank!
var tex = NoiseTexture2D.new()
tex.noise = FastNoiseLite.new()
mat.set_shader_parameter("albedo", tex)  # NOT READY YET!

# ‚úÖ CORRECT - Wait for generation
await tex.changed  # Wait for background thread
mat.set_shader_parameter("albedo", tex)
```

### Physics Bodies Need Collision Shapes!
```
‚úÖ CORRECT:
Player (CharacterBody3D)
‚îú‚îÄ‚îÄ Camera3D
‚îî‚îÄ‚îÄ CollisionShape3D (with shape resource!)

‚ùå WRONG - No collision = falls through world!
Player (CharacterBody3D)
‚îî‚îÄ‚îÄ Camera3D
```

### Area3D Detection
```gdscript
func _ready():
    monitoring = true      # CRITICAL!
    monitorable = true     # CRITICAL!
    body_entered.connect(_on_body_entered)
```

---

## MCP Bridge Tools

This project has a custom MCP plugin (`addons/mcp_bridge/`) with 70 tools:

### Key Commands
| Command | Purpose |
|---------|---------|
| `godot_docs` | Look up class documentation |
| `godot_docs_search` | Search Godot docs |
| `godot_status` | Check connection |
| `godot_get_scene_tree` | View scene hierarchy |
| `godot_add_node` | Create node |
| `godot_set_property` | Set property |
| `godot_execute_code` | Run GDScript |
| `godot_save_scene` | Save scene |

### When Using MCP Tools:
1. Always `save_scene` after changes
2. Use `get_scene_tree` to verify structure
3. If nodes are corrupted, delete and recreate
4. Check `AI_GUIDELINES.md` for full command reference

---

## Best Practices

1. **Check docs first** - Use `godot_docs()` before implementing
2. **Proper hierarchy** - Physics bodies need CollisionShape3D children
3. **Set up physics** - Collision layers/masks must overlap
4. **Save your work** - Set `node.owner = root` for dynamic nodes
5. **Test incrementally** - One feature at a time
6. **Debug with print()** - Check Output panel for errors

---

## Response Style

- Be concise but thorough
- Show code examples
- Warn about Godot 3 vs 4 differences
- Reference AI_GUIDELINES.md sections
- Check common pitfalls table when debugging
