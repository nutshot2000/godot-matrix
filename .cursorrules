# Godot MCP Bridge Project - Cursor Rules

You are a **senior developer** with expertise in:
- **Godot 4.5.1** game development (GDScript 2.0)
- **Python** (FastMCP, TCP sockets)
- Game architecture and physics systems

---

## üöÄ NEW USER SETUP (Guide users through this!)

If this is a fresh clone or the user asks about setup, guide them through these steps:

### Step 1: Install Python Dependencies
```bash
cd mcp_server
pip install -r requirements.txt
```

### Step 2: Configure Cursor MCP
Tell the user to add this to their Cursor MCP settings:
- **Windows:** `%APPDATA%\Cursor\User\globalStorage\mcp.json`
- **Mac:** `~/Library/Application Support/Cursor/User/globalStorage/mcp.json`
- Or: Cursor Settings ‚Üí MCP ‚Üí Add Server

```json
{
  "mcpServers": {
    "Godot": {
      "command": "python",
      "args": ["FULL_PATH_TO/mcp_server/server.py"]
    }
  }
}
```
**IMPORTANT:** Replace `FULL_PATH_TO` with the actual path to the cloned repo!

### Step 3: Open Godot Project
1. Open Godot 4.5+
2. Import ‚Üí Navigate to `godot_project/` ‚Üí Select `project.godot`
3. Open the project

### Step 4: Enable the Plugin
1. In Godot: **Project** ‚Üí **Project Settings** ‚Üí **Plugins** tab
2. Find **MCP Bridge** and set to **Enabled** ‚úÖ
3. Look for: `MCP Bridge: Plugin initialized and server started` in Output

### Step 5: Test Connection
Ask the user to say: "Check if Godot is connected"
Then run `godot_status()` - should return "pong"

---

## üìö ALWAYS USE DOC LOOKUP FIRST!

Before implementing ANY Godot feature, use the built-in documentation tools:

```
godot_docs("MeshInstance3D")       # Look up a class
godot_docs_search("collision")     # Search for a topic
```

This prevents common mistakes like using wrong API methods!

---

## Project Overview

This project contains:
1. **`godot_project/`** - A Godot 4.5.1 game project with an MCP bridge plugin
2. **`mcp_server/`** - Python MCP server that communicates with Godot (70 tools!)

## IMPORTANT: Read Before Coding!

### For Godot Work
**READ `godot_project/AI_GUIDELINES.md` FIRST!**

It contains 3400+ lines of comprehensive documentation. Use this map to find what you need:

| Task | Look at Section in AI_GUIDELINES.md |
|------|-------------------------------------|
| **3D Movement/FPS** | 6. CharacterBody3D Movement |
| **2D Platformer** | 35. CharacterBody2D, 43. 2D Platformer Template |
| **Physics/Collision** | 3. Physics System, 33. RigidBody3D, 40. RigidBody2D |
| **Signals (Godot 4)** | 7. Signals & Connections |
| **Animation** | 8. Animation System, 38. AnimatedSprite2D |
| **Save/Load** | 27. Saving & Loading, Save/Load System |
| **Navigation/AI** | 30. Navigation (3D), 45. 2D Navigation |
| **TileMaps** | 36. TileMap & TileSet |
| **Terrain** | Terrain & Landscapes (3D) |
| **Lighting** | Lighting Presets |
| **UI Templates** | UI Templates |
| **Particles** | Particles (GPUParticles3D) |
| **Primitives** | Primitive Meshes |

**INSTRUCTION:** Always COPY patterns from the guidelines to ensure Godot 4.5 compatibility.

### For Python/MCP Work
The MCP server (`mcp_server/server.py`) uses FastMCP and communicates with Godot via TCP on port 42069.

## Critical Godot 4 vs Godot 3 Differences

### NO C-Style Ternary!
```gdscript
# ‚ùå PARSE ERROR
var x = cond ? "a" : "b"

# ‚úÖ CORRECT
var x = "a" if cond else "b"
```

### Signal Connection Changed
```gdscript
# ‚ùå Godot 3 (WRONG)
connect("signal", self, "method")

# ‚úÖ Godot 4 (CORRECT)
signal_name.connect(method)
```

### Animation System Changed
```gdscript
# ‚ùå Godot 3 (FAILS)
player.add_animation("name", anim)

# ‚úÖ Godot 4 (CORRECT)
var lib = player.get_animation_library("")
lib.add_animation("name", anim)
```

### Material Override Gotcha
```gdscript
# ‚ùå WRONG - Returns null after godot_apply_shader!
var mat = mesh.material_override

# ‚úÖ CORRECT - Use surface override
var mat = mesh.get_surface_override_material(0)
```

## Project Structure

```
godot-matrix/
‚îú‚îÄ‚îÄ .cursorrules              # This file (AI instructions)
‚îú‚îÄ‚îÄ README.md                 # User documentation
‚îú‚îÄ‚îÄ LICENSE                   # MIT License
‚îú‚îÄ‚îÄ godot_project/
‚îÇ   ‚îú‚îÄ‚îÄ .cursorrules          # Godot-specific AI rules
‚îÇ   ‚îú‚îÄ‚îÄ AI_GUIDELINES.md      # COMPREHENSIVE GUIDE (3400+ lines)
‚îÇ   ‚îú‚îÄ‚îÄ project.godot         # Godot project file
‚îÇ   ‚îî‚îÄ‚îÄ addons/mcp_bridge/    # MCP plugin
‚îÇ       ‚îú‚îÄ‚îÄ plugin.cfg        # Plugin config
‚îÇ       ‚îú‚îÄ‚îÄ mcp_bridge.gd     # Plugin entry point
‚îÇ       ‚îî‚îÄ‚îÄ server.gd         # TCP server (2800+ lines)
‚îî‚îÄ‚îÄ mcp_server/
    ‚îú‚îÄ‚îÄ server.py             # Python MCP server (70 tools)
    ‚îî‚îÄ‚îÄ requirements.txt      # Python dependencies
```

## Key MCP Commands (70 Total)

| Command | Purpose |
|---------|---------|
| `godot_status` | Check if Godot is connected |
| `godot_docs` | **Look up class documentation** |
| `godot_docs_search` | **Search Godot docs** |
| `godot_get_scene_tree` | Get current scene structure |
| `godot_add_node` | Create new node |
| `godot_set_property` | Modify node property |
| `godot_execute_code` | Run GDScript in editor |
| `godot_save_scene` | Save current scene |
| `godot_lighting_preset` | Setup scene lighting |
| `godot_create_primitive` | Create 3D shapes |
| `godot_create_ui_template` | Create UI layouts |
| `godot_create_particle_effect` | Create particles |
| `godot_generate_terrain_mesh` | Create procedural terrain |
| `godot_write_binary_file` | Upload images/assets (base64) |

## Workflow Tips

1. **Check docs first** - Use `godot_docs()` before implementing
2. **Always check Godot status** before sending commands
3. **Save scene after changes** - changes won't persist otherwise
4. **Use the guidelines** - most common issues are documented
5. **Delete and recreate** corrupted nodes rather than patching
6. **Test incrementally** - one feature at a time
7. **Scene Safety:** `godot_save_scene` will block overwriting if you are editing a different scene. Use `ignore_safety=True` to override.

## Response Guidelines

- **Guide new users through setup** if they just cloned the repo
- Use `godot_docs()` to verify API usage before coding
- Reference `AI_GUIDELINES.md` sections when relevant
- Warn about Godot 3 vs 4 syntax differences
- Show working code examples
- When debugging, check the common pitfalls table first
